<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="Images/chromie.png">
  <title>Chromie‚Äôs Cell Quiz</title>
  <style>
    body {
      font-family:  'Segoe UI', sans-serif;
      background-color: #b0cbe4;
      color: #333;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #393e48;
    }
    .quiz-container {
      max-width: 700px;
      margin: 0 auto;
      background-color: #ffffff;
      border: 2px dashed #596071;
      padding: 20px;
      border-radius: 12px;
    }

    .question {
      margin-bottom: 25px;
    }

    .question h3 {
      margin-bottom: 10px;
    }
    .question label {
      display: block;
      margin-bottom: 6px;
      cursor: pointer;
    }
    .button-group {
  display: flex;
  justify-content: center; /* centers horizontally */
  align-items: center;
  gap: 10px; /* controls spacing between buttons */
  margin-top: 20px;
}


    .submit-button {
      background-color: #656565;
      color: white;
      padding: 10px 20px;
      border: none;
      font-size: 1.2em;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
    }

    .back-button {
  background-color: #b0cbe4;
  color: #333;
  padding: 10px 20px;
  border: none;
  font-size: 1.2em;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 10px;
}
    #backButton {
  position: fixed;
  bottom: 20px;
  right: 80px;
  background-color: white;
  color: white;
  border: none;
  border-radius: 50px;
  padding: 12px 20px;
  font-size: 1em;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  cursor: pointer;
  z-index: 1000;
  transition: background-color 0.3s ease;
}

#backButton:hover {
  background-color: white;
}
  </style>
</head>
<body>
  <h1>üß† Chromie‚Äôs Cell Division Quiz</h1>

  <div class="quiz-container" id="quizForm"></div>

<div class="button-group">
  <button class="submit-button" id="submitQuiz">Submit Answers</button>
  <button class="submit-button" onclick="window.location.href='bio.html'">Back to Home</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
import { getFirestore, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
import { setDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
import { Timestamp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAxVQYxGfceb_Hu4FcGFDVduFKa5atIfgE",
  authDomain: "chromiencellcyclecircus.firebaseapp.com",
  projectId: "chromiencellcyclecircus",
  storageBucket: "chromiencellcyclecircus.firebasestorage.app",
  messagingSenderId: "274813718407",
  appId: "1:274813718407:web:7724d59ced02b0de7b8d22",
  measurementId: "G-MP9JGD7VB3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// üß† Question Pool
const questionPool = [
  { id: "q1", category: "Mitosis", question: "What phase of mitosis do chromosomes line up in the middle?", options: ["Prophase", "Metaphase", "Telophase"], answer: "Metaphase", explanation: "Metaphase is when chromosomes align at the cell's equator for separation." },
  { id: "q2", category: "Meiosis", question: "Which process results in four genetically unique cells?", options: ["Mitosis", "Meiosis", "Binary Fission"], answer: "Meiosis", explanation: "Meiosis produces four genetically diverse gametes through recombination." },
  { id: "q3", category: "Overall", question: "What structure pulls chromosomes apart during cell division?", options: ["Spindle fibers", "Ribosomes", "Lysosomes"], answer: "Spindle fibers", explanation: "Spindle fibers attach to chromosomes and pull them to opposite poles." },
  { id: "q4", category: "Mitosis", question: "What‚Äôs Chromie‚Äôs favorite phase?", options: ["Interphase", "Metaphase", "Cytokinesis"], answer: "Metaphase", explanation: "Chromie loves Metaphase‚Äîit's the center-stage posing moment." },
  { id: "q5", category: "Mitosis", question: "What is the primary purpose of mitosis?", options: ["To produce energy for the cell", "To create two identical daughter cells", "To repair damage DNA"], answer: "To create two identical daughter cells", explanation: "Mitosis creates two genetically identical daughter cells." },
  { id: "q6", category: "Mitosis", question: "During which phase of mitosis do sister chromatids separate?", options: ["Prophase", "Metaphase", "Anaphase"], answer: "Anaphase", explanation: "In Anaphase, sister chromatids are pulled apart toward opposite sides." },
  { id: "q7", category: "Overall", question: "What is the role of spindle fibers during cell division?", options: ["To replicate DNA", "To pull chromosomes apart", "To form the nuclear envelope"], answer: "To pull chromosomes apart", explanation: "Spindle fibers physically move chromosomes during division." },
  { id: "q8", category: "Overall", question: "What is the main difference between mitosis and meiosis?", options: ["Mitosis involves crossing over", "Mitosis creates identical cells", "Mitosis occurs in gametes"], answer: "Mitosis creates identical cells", explanation: "Meiosis includes recombination and results in genetically diverse cells." },
  { id: "q9", category: "Meiosis", question: "What is the name of the structure where crossing over occurs during meiosis?", options: ["Centromere", "Chiasma", "Nucleolus"], answer: "Chiasma", explanation: "Chiasma is the crossover point between homologous chromosomes during meiosis." },
  {id: "q10", category: "Overall", question: "When a cell stop growing, say due to a shortage of nutrients, this will occur in which phase of cell cycle?", options: ["G1", "S", "G2","M"], answer: "G1", explanation: "If a cell encounters unfavorable conditions, such as a shortage of nutrients, it can exit the cell cycle from G1 and enter a quiescent state known as G0, where it stops growing and dividing until conditions improve."},
{
	id: "q11",
	category: "Meiosis",
    	question: "If at the end of meiosis, the four daughter cells have four chromosomes, how many chromosomes were in the mother cell? ",
    	options: ["2", "4", "8","16"],
   	answer: "8",
	explanation: " if the four daughter cells each have 4 chromosomes, the original mother cell (which is diploid) must have had double that amount."
	},
{
id: "q12",
	category: "Meiosis",
    	question: "How many daughter cells are produced by meiosis? ",
    	options: ["2", "4", "8"],
   	answer: "4",
	explanation: " Meiosis is a type of cell division that results in four daughter cells, each with half the number of chromosomes as the parent cell."
	},
	const questionPool = [
  {
    id: "q13",
    category: "Meiosis",
    question: "Which of the following cells is a product of meiosis?",
    options: ["Red blood cell", "White blood cell", "Neuron", "Sperms"],
    answer: "Sperms",
    explanation: "Sperms are male gametes, which are produced through meiosis and are haploid."
  },
  {
    id: "q14",
    category: "Meiosis",
    question: "Which of the following events contributes to genetic variation in meiosis?",
    options: ["Cytokinesis", "DNA Replication", "Independent assortment"],
    answer: "Independent assortment",
    explanation: "The maternal and paternal chromosomes are randomly sorted into the daughter cells, leading to different combinations of alleles in the resulting gametes."
  },
  {
    id: "q15",
    category: "Overall",
    question: "Which of the following cannot be used to differentiate meiosis from mitosis?",
    options: ["Replication of chromosomes occur during Interphase", "Cause crossing over", "Formation of tetrad", "Produce variation in daughter cell"],
    answer: "Replication of chromosomes occur during Interphase",
    explanation: "Both mitosis and meiosis are preceded by interphase, during which DNA replication occurs. This shared event cannot be used to differentiate between them."
  },
  {
    id: "q16",
    category: "Meiosis",
    question: "During meiosis, when are chromosomes replicated?",
    options: ["Interkinesis", "Prophase II", "Interphase", "Prophase I"],
    answer: "Interphase",
    explanation: "Chromosomes are replicated during Interphase, specifically during the S phase."
  },
  {
    id: "q17",
    category: "Meiosis",
    question: "At what phase of meiosis are there two cells, each with sister chromatids aligned at the spindle equator?",
    options: ["Metaphase II", "Metaphase I", "Interphase", "Anaphase I", "Anaphase II"],
    answer: "Metaphase II",
    explanation: "Sister chromatids align along the metaphase plate in preparation for separation during Anaphase II."
  },
  {
    id: "q18",
    category: "Meiosis",
    question: "At what phase of meiosis are homologous chromosomes separated?",
    options: ["Prophase I", "Prophase II", "Anaphase I", "Anaphase II"],
    answer: "Anaphase I",
    explanation: "Spindle fibers pull homologous chromosomes to opposite poles, reducing chromosome number by half."
  },
  {
    id: "q19",
    category: "Overall",
    question: "At what stage does cytokinesis typically occur?",
    options: ["Anaphase", "Prophase", "Telophase", "Interphase"],
    answer: "Telophase",
    explanation: "Telophase is the final stage of nuclear division, where chromosomes decondense and nuclear envelopes reform."
  },
  {
    id: "q20",
    category: "Meiosis",
    question: "State the number of chromosomes in a fertilized egg.",
    options: ["The same as in the sperm", "Twice the number as in skin cell", "Twice the number as in the sperm", "Half as many as in an unfertilized egg"],
    answer: "Twice the number as in the sperm",
    explanation: "A fertilized egg (zygote) is diploid, formed by fusion of two haploid gametes (sperm and egg)."
  }
{
  id: "q21",
  category: "Mitosis",
  question: "Which phase of mitosis involves the breakdown of the nuclear envelope?",
  options: ["Prophase", "Metaphase", "Telophase", "Anaphase"],
  answer: "Prophase",
  explanation: "During prophase, the nuclear envelope dissolves, allowing spindle fibers to access chromosomes."
},
{
  id: "q22",
  category: "Mitosis",
  question: "What structure forms to organize and pull apart chromosomes during mitosis?",
  options: ["Centrosome", "Spindle apparatus", "Nucleolus", "Cytoskeleton"],
  answer: "Spindle apparatus",
  explanation: "The spindle apparatus is a dynamic structure that guides chromosome movement during mitosis."
},
{
  id: "q23",
  category: "Mitosis",
  question: "Which phase of mitosis is characterized by chromosomes condensing and becoming visible?",
  options: ["Prophase", "Anaphase", "Telophase", "Interphase"],
  answer: "Prophase",
  explanation: "In prophase, chromatin condenses into visible chromosomes, prepping for division."
},
{
  id: "q24",
  category: "Mitosis",
  question: "What is the final result of mitosis?",
  options: ["Four haploid cells", "Two identical diploid cells", "One large cell", "Two cells with half the DNA"],
  answer: "Two identical diploid cells",
  explanation: "Mitosis produces two genetically identical cells with the same diploid chromosome number."
},
{
  id: "q25",
  category: "Mitosis",
  question: "Which phase of mitosis follows anaphase?",
  options: ["Prophase", "Telophase", "Metaphase", "Interphase"],
  answer: "Telophase",
  explanation: "Telophase is when chromosomes reach the poles and nuclear envelopes reform."
}
{
  id: "q26",
  category: "Overall",
  question: "What is the purpose of cell division in multicellular organisms?",
  options: ["To produce gametes", "To generate energy", "To grow and repair tissues", "To digest nutrients"],
  answer: "To grow and repair tissues",
  explanation: "Cell division allows organisms to grow, replace damaged cells, and maintain tissue health."
},
{
  id: "q27",
  category: "Overall",
  question: "Which phase of the cell cycle involves DNA replication?",
  options: ["G1", "S", "G2", "M"],
  answer: "S",
  explanation: "The S phase (synthesis) is when DNA is replicated to prepare for cell division."
},
{
  id: "q28",
  category: "Overall",
  question: "What is the name of the resting phase where cells exit the cycle?",
  options: ["G0", "G1", "S", "M"],
  answer: "G0",
  explanation: "Cells enter G0 when they stop dividing, often due to lack of signals or resources."
},
{
  id: "q29",
  category: "Overall",
  question: "Which checkpoint ensures DNA is correctly replicated before mitosis?",
  options: ["G1 checkpoint", "G2 checkpoint", "M checkpoint", "S checkpoint"],
  answer: "G2 checkpoint",
  explanation: "The G2 checkpoint verifies DNA integrity before the cell enters mitosis."
},
{
  id: "q30",
  category: "Overall",
  question: "What type of cells typically undergo mitosis regularly?",
  options: ["Gametes", "Skin cells", "Neurons", "Sperm cells"],
  answer: "Skin cells",
  explanation: "Skin cells divide frequently via mitosis to replace dead or damaged cells."
}
];

// üîÄ Shuffle helper
function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

// üéØ Weighted scoring
const categoryWeights = {
  Mitosis: 1.5,
  Meiosis: 1.5,
  Overall: 2
};

// üß™ Render Quiz
const selectedQuestions = shuffle(questionPool).slice(0, 10);
const quizForm = document.getElementById("quizForm");

selectedQuestions.forEach((q, index) => {
  const div = document.createElement("div");
  div.className = "question";
  div.innerHTML = `<h3>${index + 1}. ${q.question}</h3>` +
    q.options.map(opt => `<label><input type="radio" name="${q.id}" value="${opt}"> ${opt}</label>`).join("");
  quizForm.appendChild(div);
});

// üß† Submit Logic
document.getElementById("submitQuiz").onclick = async function () {
  let totalWeight = 0;
  let earnedWeight = 0;
  let feedback = "";
  const categoryScores = {};

  selectedQuestions.forEach((q, i) => {
    const radios = document.getElementsByName(q.id);
    let userAnswer = null;
    for (const radio of radios) {
      if (radio.checked) {
        userAnswer = radio.value;
        break;
      }
    }

    const weight = categoryWeights[q.category.trim()] || 1;
    totalWeight += weight;

    const cat = q.category.trim();
    if (!categoryScores[cat]) {
      categoryScores[cat] = { correct: 0, total: 0 };
    }
    categoryScores[cat].total++;
    if (userAnswer === q.answer) {
      earnedWeight += weight;
      categoryScores[cat].correct++;
    } else {
      feedback += `Question ${i + 1}: ‚ùå Incorrect. ${q.explanation}\n\n`;
    }
  });

  const score = Math.round((earnedWeight / totalWeight) * 100);
  alert(`‚úÖ You scored ${score}%\n\n${feedback}`);

  if (score < 60) {
    alert("üí™ Chromie says: Work harder! You‚Äôve got potential!");
  } else {
    alert("üéâ Chromie says: Congrats! Cell-tacular job!");
  }

  const user = auth.currentUser;
  if (!user) {
    alert("‚ö†Ô∏è You must be logged in to save your score.");
    return;
  }

  const userRef = doc(db, "users", user.uid);

  try {
    const userSnap = await getDoc(userRef);
    const data = userSnap.exists() ? userSnap.data() : {};
    const previousHistory = data.achievements?.quizHistory || [];

    const newEntry = {
  score,
  timestamp: Timestamp.fromDate(new Date())
};

    const updatedHistory = [...previousHistory, newEntry];

    const updates = {
      achievements: {
        quizScore: score,
        quizHistory: updatedHistory
      },
      quizProgress: {}
    };

    for (const [cat, { correct, total }] of Object.entries(categoryScores)) {
      updates.quizProgress[cat] = {
        score: correct,
        total,
        updatedAt: new Date()
      };
    }
    
    console.log("Saving to Firestore:", updates);

        await updateDoc(userRef, {
      "achievements.quizScore": score,
      "achievements.quizHistory": updatedHistory,
      ...Object.fromEntries(
        Object.entries(categoryScores).map(([cat, { correct, total }]) => [
          `quizProgress.${cat}`,
          {
            score: correct,
            total,
            updatedAt: Timestamp.fromDate(new Date())
          }
        ])
      )
    });

  } catch (error) {
    console.error("‚ùå Firestore update failed:", error.code, error.message);
    alert("‚ö†Ô∏è Failed to save your score. Please try again.");
  }
}; // Close submitQuiz.onclick

</script>

</body>

  
  <script>
    (function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="STSTJwg07d9WPTV7bPW3w";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
</script>
  

</body>
</html>

